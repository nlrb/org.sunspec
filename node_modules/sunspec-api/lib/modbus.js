var ModBus = {
	// calcCRC
	calcCRC: function(data) {
		var crc = 0xffff;

		for (var pos = 0; pos < data.length; pos++) {
			crc ^= data[pos];
			for (var i = 8; i != 0; i--) {
				if (crc & 0x1 != 0) {
					crc >>= 1;
					crc ^= 0xA001;
				} else {
					crc >>= 1;
				}
			}
		}
		return crc
	},

	// modbus.makeRequest
	makeRequest: function(modBusId, func, addr, cnt) {
		var addrLo = (addr - 1) & 0xff;
		var addrHi = (addr - 1) >> 8;
		var req = [modBusId, func, addrHi, addrLo, 0x00, cnt];

		var crc = ModBus.calcCRC(req);
		var crcLo = crc & 0xff;
		var crcHi = crc >> 8;

		return req.concat([crcLo, crcHi]);
	}
}

module.exports = ModBus;